generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum Role {
  SUPERADMIN
  ADMIN
  VIEWER
}

enum user_status {
  ACTIVE
  INACTIVE
}

enum status {
  OPERATIONAL
  NON_OPERATIONAL
}

model user {
  id            String       @id @db.Uuid // Same as auth.users.id from Supabase
  username      String       @unique
  full_name     String
  phone         String?
  user_profile  String?
  role          Role         @default(VIEWER)
  user_status   user_status  @default(ACTIVE)
  created_at    DateTime     @default(now())
  updated_at    DateTime     @updatedAt

  @@map("users")
}

model location {
  id                                String                        @id @default(uuid()) @db.Uuid
  address                           String
  clients                           client[]
  created_at                        DateTime                      @default(now())
  updated_at                        DateTime                      @updatedAt
  maintenance_equipment_reports     maintenance_equipment_report[]

  @@map("locations")
}

model client {
  id          String    @id @default(uuid()) @db.Uuid
  name        String
  location_id String    @db.Uuid
  location    location  @relation(fields: [location_id], references: [id])
  projects    project[]
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt

  @@map("clients")
}

model project {
  id         String      @id @default(uuid()) @db.Uuid
  name       String
  client_id  String      @db.Uuid
  client     client      @relation(fields: [client_id], references: [id])
  equipments equipment[]
  vehicles   vehicle[]
  created_at DateTime    @default(now())
  updated_at DateTime    @updatedAt

  @@map("projects")
}

model equipment {
  id                            String                        @id @default(uuid()) @db.Uuid
  brand                         String
  model                         String
  type                          String
  insurance_expiration_date     DateTime?                     @default(now())
  before                        Int? // in months
  status                        status
  remarks                       String?
  owner                         String
  image_url                     String?
  inspection_date               DateTime?
  project_id                    String                        @db.Uuid
  plate_number                  String?
  original_receipt_url          String?
  equipment_registration_url    String?
  thirdparty_inspection_image   String?
  pgpc_inspection_image         String?
  equipment_parts               String[]
  project                       project                       @relation(fields: [project_id], references: [id])
  created_at                    DateTime                      @default(now())
  updated_at                    DateTime                      @updatedAt
  maintenance_reports           maintenance_equipment_report[]

  @@map("equipment")
}

model vehicle {
  id                      String   @id @default(uuid()) @db.Uuid
  brand                   String
  model                   String
  type                    String
  plate_number            String
  inspection_date         DateTime
  before                  Int // in months
  expiry_date             DateTime
  status                  status
  remarks                 String?
  owner                   String
  front_img_url           String?
  back_img_url            String?
  side1_img_url           String?
  side2_img_url           String?
  original_receipt_url    String? //image man ini para sa OR
  car_registration_url    String? //image man ini para sa CR
  pgpc_inspection_image   String? //same with the equipments igwa man pgpc
  project_id              String   @db.Uuid
  project                 project  @relation(fields: [project_id], references: [id])
  created_at              DateTime @default(now())
  updated_at              DateTime @updatedAt

  @@map("vehicles")
}

model maintenance_equipment_report {
  id                  String           @id @default(uuid()) @db.Uuid
  equipment_id        String           @db.Uuid
  equipment           equipment        @relation(fields: [equipment_id], references: [id])
  location_id         String           @db.Uuid
  location            location         @relation(fields: [location_id], references: [id])
  //reported and repaired by
  reported_by         String?
  repaired_by         String?
  //issue details
  issue_description   String
  remarks             String?
  inspection_details  String?
  action_taken        String?
  //parts
  parts_replaced      String[]
  priority            report_priority?
  //status of the report
  status              report_status?
  downtime_hours      String?
  //dates
  date_repaired       DateTime?
  date_reported       DateTime         @default(now())
  //attachment URLs
  attachment_urls     String[]
  //datecreated and updated
  created_at          DateTime         @default(now())
  updated_at          DateTime         @updatedAt

  @@map("maintenance_equipment_reports")
}

enum report_priority {
  LOW
  MEDIUM
  HIGH
}

enum report_status {
  REPORTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}
